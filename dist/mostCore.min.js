!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.mostCore=t.mostCore||{})}(this,function(t){"use strict";function e(t,e){if(t<0)throw new TypeError("n must be >= 0");var i=e.length;return 0===t||0===i?e:t>=i?[]:n(t,e,i-t)}function n(t,e,n){for(var i=new Array(n),r=0;r<n;++r)i[r]=e[t+r];return i}function i(t){return e(1,t)}function r(t){for(var e=t.length,n=new Array(e),i=0;i<e;++i)n[i]=t[i];return n}function o(t,e){for(var n=e.length,i=new Array(n),r=0;r<n;++r)i[r]=t(e[r]);return i}function s(t,e,n){for(var i=e,r=0,o=n.length;r<o;++r)i=t(i,n[r],r);return i}function u(t,e){for(var n=e.length,i=new Array(n),r=0,o=void 0,s=0;s<n;++s)o=e[s],t(o)||(i[r]=o,++r);return i.length=r,i}function h(t,e){for(var n=0,i=e.length;n<i;++n)if(t===e[n])return n;return-1}function c(t){function e(n,i){switch(arguments.length){case 0:return e;case 1:return function(e){return t(n,e)};default:return t(n,i)}}return e}function p(t){function e(n,i,r){switch(arguments.length){case 0:return e;case 1:return c(function(e,i){return t(n,e,i)});case 2:return function(e){return t(n,i,e)};default:return t(n,i,r)}}return e}function a(t){this.source=t}function f(t){try{return t.dispose()}catch(t){return Promise.reject(t)}}function d(t){return null!==t&&"object"==typeof t&&"function"==typeof t.then}function l(t,e,n){var i=f(e);return d(i)?i.catch(function(e){return n.error(t,e)}):i}function v(t){setTimeout(function(){throw t},0)}function y(t,e,n){this._run=t,this.value=e,this.sink=n,this.active=!0}function w(t,e,n){n.error(t,e)}function k(t,e,n){n.event(t,e)}function m(t,e,n){n.end(t,e)}function _(t,e,n){n.event(t,e),n.end(t,void 0)}function g(t){return new a(new wn(t))}function b(t){return new a(new x(t))}function x(t){this.array=t}function A(t,e,n){function i(t){n.end(t)}for(var r=0,o=e.length;r<o&&this.active;++r)n.event(t,e[r]);this.active&&i(t)}function T(t){return t[kn]()}function E(t,e,n){for(var i=e.next();!i.done&&this.active;)n.event(t,i.value),i=e.next();n.end(t,i.value)}function P(t,e,n,i){var r=sn(),o=new xn(n,i,r);r.setDisposable(t.run(o,e))}function I(t){this.sink=t}function C(t,e,n){return new a(new M(t,e,n.source))}function M(t,e,n){this.step=t,this.seed=e,this.source=n}function R(t,e,n){this.step=t,this.seed=e,this.sink=n}function q(t,e){return new a(new N(t,e))}function N(t,e){this.f=t,this.value=e}function S(t,e,n,i){function r(t){s.sink.error(s.scheduler.now(),t)}function o(t){return B(t,e)}this.f=t,this.sink=n,this.scheduler=i,this.active=!0;var s=this;Promise.resolve(this).then(o).catch(r)}function B(t,e){var n=t.f;return Promise.resolve(n(e)).then(function(e){return j(t,e)})}function j(t,e){return e.done?(t.sink.end(t.scheduler.now(),e.value),e.value):(t.sink.event(t.scheduler.now(),e.value),t.active?B(t,e.seed):e.value)}function V(t,e){return new a(new W(t,e))}function W(t,e){this.f=t,this.value=e}function D(t,e,n,i){function r(t){u.sink.error(u.scheduler.now(),t)}function o(t){return O(t,s)}this.f=t,this.sink=n,this.scheduler=i,this.active=!0;var s=e,u=this;Promise.resolve(this).then(o).catch(r)}function O(t,e){if(t.sink.event(t.scheduler.now(),e),!t.active)return e;var n=t.f;return Promise.resolve(n(e)).then(function(e){return z(t,e)})}function z(t,e){return t.active?O(t,e):t.value}function L(t){return new a(new F(t,i(arguments)))}function F(t,e){this.f=t,this.args=e}function G(t,e,n){function i(t){r.sink.error(r.scheduler.now(),t)}this.iterator=t,this.sink=e,this.scheduler=n,this.active=!0;var r=this;Promise.resolve(this).then(H).catch(i)}function H(t,e){return t.active?J(t,t.iterator.next(e)):e}function J(t,e){return e.done?t.sink.end(t.scheduler.now(),e.value):Promise.resolve(e.value).then(function(e){return K(t,e)},function(e){return Q(t,e)})}function K(t,e){return t.sink.event(t.scheduler.now(),e),H(t,e)}function Q(t,e){return J(t,t.iterator.throw(e))}function U(t,e){return new a(new X(t,e.source))}function X(t,e){this.f=t,this.source=e}function Y(t,e,n,i){this.f=t,this.sink=n,this.scheduler=i,this.active=!0,this.disposable=un(e.run(this,i))}function Z(t,e){this.p=t,this.source=e}function $(t,e){this.p=t,this.sink=e}function tt(t,e){return function(n){return t(n)&&e(n)}}function et(t,e,n){this.p=t,this.f=e,this.source=n}function nt(t,e,n){this.p=t,this.f=e,this.sink=n}function it(t,e){this.f=t,this.source=e}function rt(t,e){this.f=t,this.sink=e}function ot(t,e){return new a(it.create(t,e.source))}function st(t,e){return ot(function(){return t},e)}function ut(t,e){return new a(new ht(t,e.source))}function ht(t,e){this.source=e,this.f=t}function ct(t,e){this.sink=e,this.f=t}function pt(t,e){this.sink=e,this.index=t,this.active=!0,this.value=void 0}function at(t,e){switch(e.length){case 0:return t();case 1:return t(e[0]);case 2:return t(e[0],e[1]);case 3:return t(e[0],e[1],e[2]);case 4:return t(e[0],e[1],e[2],e[3]);case 5:return t(e[0],e[1],e[2],e[3],e[4]);default:return t.apply(void 0,e)}}function ft(t){return dt(t,Rn(arguments))}function dt(t,e){var n=e.length;return 0===n?pn():1===n?ot(t,e[0]):new a(lt(t,e))}function lt(t,e){return new yt(t,Mn(vt,e))}function vt(t){return t.source}function yt(t,e){this.f=t,this.sources=e}function wt(t,e,n,i){var r=this;this.sink=n,this.disposables=t,this.sinks=e,this.f=i;var o=e.length;this.awaiting=o,this.values=new Array(o),this.hasValue=new Array(o);for(var s=0;s<o;++s)r.hasValue[s]=!1;this.activeCount=e.length}function kt(t,e){return ft(Ye,t,e)}function mt(){this.head=null,this.length=0}function _t(t,e){return gt(Ue,t,e)}function gt(t,e,n){return new a(new bt(t,e,n.source))}function bt(t,e,n){this.f=t,this.concurrency=e,this.source=n}function xt(t,e,n,i,r){this.f=t,this.concurrency=e,this.sink=i,this.scheduler=r,this.pending=[],this.current=new mt,this.disposable=un(n.run(this,r)),this.active=!0}function At(t,e,n,i){return t(e).source.run(n,i)}function Tt(t,e,n){this.prev=this.next=null,this.time=t,this.outer=e,this.sink=n,this.disposable=void 0}function Et(t,e){return gt(t,1,e)}function Pt(){return It(Sn(arguments))}function It(t){var e=t.length;return 0===e?pn():1===e?t[0]:new a(Ct(t))}function Ct(t){return new Rt(Bn(Mt,[],t))}function Mt(t,e){var n=e.source;return n instanceof Rt?t.concat(n.sources):t.concat(n)}function Rt(t){this.sources=t}function qt(t,e,n){this.sink=n,this.disposables=t,this.activeCount=e.length}function Nt(t){this._capacity=t||32,this._length=0,this._head=0}function St(t,e,n,i,r){for(var o=0;o<r;++o)n[o+i]=t[o+e],t[o+e]=void 0}function Bt(t){return jt(t,zn(arguments))}function jt(t,e){return 0===e.length?pn():1===e.length?ot(t,e[0]):new a(new Wt(t,On(Vt,e)))}function Vt(t){return t.source}function Wt(t,e){this.f=t,this.sources=e}function Dt(t,e,n,i){this.f=t,this.sinks=n,this.sink=i,this.buffers=e}function Ot(t,e,n,i){i.event(e,at(t,On(zt,n)))}function zt(t){return t.shift()}function Lt(t,e){for(var n=0,i=t.length;n<i;++n)if(t[n].isEmpty()&&!e[n].active)return!0;return!1}function Ft(t){for(var e=0,n=t.length;e<n;++e)if(t[e].isEmpty())return!1;return!0}function Gt(t,e){return new a(Z.create(t,e.source))}function Ht(t){return Jt(Ut,t)}function Jt(t,e){return new a(new Kt(t,e.source))}function Kt(t,e){this.equals=t,this.source=e}function Qt(t,e){this.equals=t,this.sink=e,this.value=void 0,this.init=!0}function Ut(t,e){return t===e}function Xt(t,e){return Zt(0,t,e)}function Yt(t,e){return Zt(t,1/0,e)}function Zt(t,e,n){return e<=t?pn():new a($t(t,e,n.source))}function $t(t,e,n){return n instanceof it?te(t,e,n):n instanceof ne?ee(t,e,n):new ne(t,e,n)}function te(t,e,n){return it.create(n.f,$t(t,e,n.source))}function ee(t,e,n){return t+=n.min,e=Math.min(e+n.min,n.max),new ne(t,e,n.source)}function ne(t,e,n){this.source=n,this.min=t,this.max=e}function ie(t,e,n,i,r){this.sink=i,this.skip=t,this.take=e,this.disposable=un(n.run(this,r))}function re(t,e){return new a(new oe(t,e.source))}function oe(t,e){this.p=t,this.source=e}function se(t,e,n,i){this.p=t,this.sink=n,this.active=!0,this.disposable=un(e.run(this,i))}function ue(t,e){return new a(new he(t,e.source))}function he(t,e){this.p=t,this.source=e}function ce(t,e){this.p=t,this.sink=e,this.skipping=!0}function pe(t,e){return new a(new de(t.source,e.source))}function ae(t,e){return new a(new le(t.source,e.source))}function fe(t,e){return pe(Nn(t),ae(t,e))}function de(t,e){this.maxSignal=t,this.source=e}function le(t,e){this.minSignal=t,this.source=e}function ve(t,e){this.value=t,this.sink=e}function ye(t,e,n){this.min=t,this.max=e,this.sink=n}function we(t,e,n){this.value=1/0,this.sink=e,this.disposable=t.run(this,n)}function ke(t,e,n){this.value=1/0,this.sink=e,this.disposable=t.run(this,n)}function me(){}function _e(t,e){return t<=0?e:new a(new ge(t,e.source))}function ge(t,e){this.dt=t,this.source=e}function be(t,e,n){this.dt=t,this.sink=e,this.scheduler=n}function xe(t,e){return new a(Ae(t,e.source))}function Ae(t,e){return e instanceof it?Te(t,e):e instanceof Pe?Ee(t,e):new Pe(t,e)}function Te(t,e){return it.create(e.f,Ae(t,e.source))}function Ee(t,e){return new Pe(Math.max(t,e.period),e.source)}function Pe(t,e){this.period=t,this.source=e}function Ie(t,e){this.time=0,this.period=t,this.sink=e}function Ce(t,e){return new a(new Me(t,e.source))}function Me(t,e){this.dt=t,this.source=e}function Re(t,e,n,i){this.dt=t,this.sink=n,this.scheduler=i,this.value=void 0,this.timer=null;var r=e.run(this,i);this.disposable=rn([this,r])}function qe(t){this.sink=t,this.active=!0}function Ne(t,e,n){try{n.event(t,e)}catch(e){n.error(t,e)}}function Se(t,e,n){try{n.end(t,e)}catch(e){n.error(t,e)}}function Be(t,e){return new a(new De(t,e.source))}function je(t){return new a(new Ve(t))}function Ve(t){this.value=t}function We(t,e,n){n.error(t,e)}function De(t,e){this.f=t,this.source=e}function Oe(t,e,n,i){this.f=t,this.sink=new qe(n),this.scheduler=i,this.disposable=e.run(this,i)}function ze(t,e,n,i){this.time=t,this.period=e,this.task=n,this.scheduler=i,this.active=!0}function Le(t){return Promise.resolve(t).then(Fe)}function Fe(t){try{return t.run()}catch(e){return t.error(e)}}function Ge(t,e,n){for(var i=0;i<e.length;++i){var r=e[i];r.active&&(t(r),r.period>=0&&r.active&&(r.time=r.time+r.period,He(r,n)))}return n}function He(t,e){var n=e.length;if(0===n)return void e.push(Zn(t.time,[t]));var i=Ke(t.time,e);i>=n?e.push(Zn(t.time,[t])):t.time===e[i].time?e[i].events.push(t):e.splice(i,0,Zn(t.time,[t]))}function Je(t,e){e.events=u(t,e.events)}function Ke(t,e){for(var n,i,r=0,o=e.length;r<o;){if(n=Math.floor((r+o)/2),i=e[n],t===i.time)return n;t<i.time?o=n:r=n+1}return o}function Qe(t){var e=new ti(t);return Le(e),e}var Ue=function(t){return t},Xe=function(t,e){return function(n){return t(e(n))}},Ye=function(t,e){return t(e)},Ze=function(t,e){this._dispose=t,this._data=e};Ze.prototype.dispose=function(){return this._dispose(this._data)};var $e=function(){var t=this;this.disposable=void 0,this.disposed=!1,this._resolve=void 0,this.result=new Promise(function(e){t._resolve=e})};$e.prototype.setDisposable=function(t){if(void 0!==this.disposable)throw new Error("setDisposable called more than once");this.disposable=t,this.disposed&&this._resolve(t.dispose())},$e.prototype.dispose=function(){return this.disposed?this.result:(this.disposed=!0,void 0!==this.disposable&&(this.result=this.disposable.dispose()),this.result)};var tn=function(t){this.disposed=!1,this.value=void 0,this.disposable=t};tn.prototype.dispose=function(){return this.disposed||(this.disposed=!0,this.value=f(this.disposable),this.disposable=void 0),this.value};var en=function(t,e){return un(new Ze(t,e))},nn=function(){return new Ze(Ue,void 0)},rn=function(t){return en(on,t)},on=function(t){return Promise.all(o(f,t))},sn=function(){return new $e},un=function(t){return new tn(t)};y.event=function(t,e){return new y(k,t,e)},y.end=function(t,e){return new y(m,t,e)},y.error=function(t,e){return new y(w,t,e)},y.prototype.dispose=function(){this.active=!1},y.prototype.run=function(t){this.active&&this._run(t,this.value,this.sink)},y.prototype.error=function(t,e){return this.active?void this.sink.error(t,e):v(e)};var hn=function(t){return new a(new cn(t))},cn=function(t){this.value=t};cn.prototype.run=function(t,e){return e.asap(new y(_,this.value,t))};var pn=function(){return dn},an=function(){};an.prototype.run=function(t,e){var n=y.end(void 0,t);return e.asap(n),en(fn,n)};var fn=function(t){return t.dispose()},dn=new a(new an),ln=function(){return yn},vn=function(){};vn.prototype.run=function(){return nn()};var yn=new a(new vn),wn=function(t){this.period=t};wn.prototype.run=function(t,e){return e.periodic(this.period,y.event(void 0,t))},x.prototype.run=function(t,e){return e.asap(new y(A,this.array,t))};var kn;kn="function"==typeof Set&&"function"==typeof(new Set)["@@iterator"]?"@@iterator":"function"==typeof Symbol&&Symbol.iterator||"_es6shim_iterator_";var mn=function(t){return new a(new _n(t))},_n=function(t){this.iterable=t};_n.prototype.run=function(t,e){return e.asap(new y(E,T(this.iterable),t))};var gn=function(t,e){var n=t.source;return bn(n,e)},bn=function(t,e){return new Promise(function(n,i){return P(t,e,n,i)})},xn=function(t,e,n){this._end=t,this._error=e,this._disposable=n,this.active=!0};xn.prototype.event=function(t,e){},xn.prototype.end=function(t,e){this.active&&(this.active=!1,An(this._end,this._error,this._disposable,e))},xn.prototype.error=function(t,e){this.active=!1,An(this._error,this._error,this._disposable,e)};var An=function(t,e,n,i){return Promise.resolve(n.dispose()).then(function(){return t(i)},e)};I.prototype.event=function(t,e){return this.sink.event(t,e)},I.prototype.end=function(t,e){return this.sink.end(t,e)},I.prototype.error=function(t,e){return this.sink.error(t,e)},M.prototype.run=function(t,e){return this.source.run(new R(this.step,this.seed,t),e)},R.prototype.error=I.prototype.error,R.prototype.event=function(t,e){var n=this.step(this.seed,e);this.seed=n.seed,this.sink.event(t,n.value)},R.prototype.end=function(t){this.sink.end(t,this.seed)};var Tn=function(t,e,n){return new a(new En(t,e,n.source))},En=function(t,e,n){this.source=n,this.f=t,this.value=e};En.prototype.run=function(t,e){var n=e.asap(y.event(this.value,t)),i=this.source.run(new Pn(this.f,this.value,t),e);return rn([n,i])};var Pn=function(t){function e(e,n,i){t.call(this),this.f=e,this.value=n,this.sink=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.event=function(t,e){var n=this.f;this.value=n(this.value,e),this.sink.event(t,this.value)},e}(I);N.prototype.run=function(t,e){return new S(this.f,this.value,t,e)},S.prototype.dispose=function(){this.active=!1},W.prototype.run=function(t,e){return new D(this.f,this.value,t,e)},D.prototype.dispose=function(){this.active=!1},F.prototype.run=function(t,e){return new G(this.f.apply(void 0,this.args),t,e)},G.prototype.dispose=function(){this.active=!1},X.prototype.run=function(t,e){return new Y(this.f,this.source,t,e)},Y.prototype.error=I.prototype.error,Y.prototype.event=function(t,e){this.active&&this.sink.event(t,e)},Y.prototype.end=function(t,e){this.active&&(l(t,this.disposable,this.sink),this._startNext(t,e,this.sink))},Y.prototype._startNext=function(t,e,n){try{this.disposable=this._continue(this.f,e,n)}catch(e){n.error(t,e)}},Y.prototype._continue=function(t,e,n){return t(e).source.run(n,this.scheduler)},Y.prototype.dispose=function(){return this.active=!1,this.disposable.dispose()};var In=function(t,e){return Cn(hn(t),e)},Cn=function(t,e){return U(function(){return e},t)};Z.create=function(t,e){return e instanceof Z?new Z(tt(e.p,t),e.source):new Z(t,e)},Z.prototype.run=function(t,e){return this.source.run(new $(this.p,t),e)},$.prototype.end=I.prototype.end,$.prototype.error=I.prototype.error,$.prototype.event=function(t,e){var n=this.p;n(e)&&this.sink.event(t,e)},et.prototype.run=function(t,e){return this.source.run(new nt(this.p,this.f,t),e)},nt.prototype.event=function(t,e){var n=this.f,i=this.p;i(e)&&this.sink.event(t,n(e))},nt.prototype.end=I.prototype.end,nt.prototype.error=I.prototype.error,it.create=function(t,e){return e instanceof it?new it(Xe(t,e.f),e.source):e instanceof Z?new et(e.p,t,e.source):new it(t,e)},it.prototype.run=function(t,e){return this.source.run(new rt(this.f,t),e)},rt.prototype.end=I.prototype.end,rt.prototype.error=I.prototype.error,rt.prototype.event=function(t,e){var n=this.f;this.sink.event(t,n(e))},ht.prototype.run=function(t,e){return this.source.run(new ct(this.f,t),e)},ct.prototype.end=I.prototype.end,ct.prototype.error=I.prototype.error,ct.prototype.event=function(t,e){var n=this.f;n(e),this.sink.event(t,e)},pt.prototype.event=function(t,e){this.active&&(this.value=e,this.sink.event(t,this))},pt.prototype.end=function(t,e){this.active&&(this.active=!1,this.sink.end(t,{index:this.index,value:e}))},pt.prototype.error=I.prototype.error;var Mn=o,Rn=i;yt.prototype.run=function(t,e){for(var n,i=this,r=this.sources.length,o=new Array(r),s=new Array(r),u=new wt(o,s,t,this.f),h=0;h<r;++h)n=s[h]=new pt(h,u),o[h]=i.sources[h].run(n,e);return rn(o)},wt.prototype.error=I.prototype.error,wt.prototype.event=function(t,e){var n=e.index,i=this._updateReady(n);this.values[n]=e.value,0===i&&this.sink.event(t,at(this.f,this.values))},wt.prototype._updateReady=function(t){return this.awaiting>0&&(this.hasValue[t]||(this.hasValue[t]=!0,this.awaiting-=1)),this.awaiting},wt.prototype.end=function(t,e){l(t,this.disposables[e.index],this.sink),0===--this.activeCount&&this.sink.end(t,e.value)},mt.prototype.add=function(t){null!==this.head&&(this.head.prev=t,t.next=this.head),this.head=t,++this.length},mt.prototype.remove=function(t){--this.length,t===this.head&&(this.head=this.head.next),null!==t.next&&(t.next.prev=t.prev,t.next=null),null!==t.prev&&(t.prev.next=t.next,t.prev=null)},mt.prototype.isEmpty=function(){return 0===this.length},mt.prototype.dispose=function(){if(this.isEmpty())return Promise.resolve();var t=[],e=this.head;for(this.head=null,this.length=0;null!==e;)t.push(e.dispose()),e=e.next;return Promise.all(t)},bt.prototype.run=function(t,e){return new xt(this.f,this.concurrency,this.source,t,e)},xt.prototype.event=function(t,e){this._addInner(t,e)},xt.prototype._addInner=function(t,e){this.current.length<this.concurrency?this._startInner(t,e):this.pending.push(e)},xt.prototype._startInner=function(t,e){try{this._initInner(t,e)}catch(e){this.error(t,e)}},xt.prototype._initInner=function(t,e){var n=new Tt(t,this,this.sink);n.disposable=At(this.f,e,n,this.scheduler),this.current.add(n)},xt.prototype.end=function(t,e){this.active=!1,l(t,this.disposable,this.sink),this._checkEnd(t,e)},xt.prototype.error=function(t,e){this.active=!1,this.sink.error(t,e)},xt.prototype.dispose=function(){return this.active=!1,this.pending.length=0,Promise.all([this.disposable.dispose(),this.current.dispose()])},xt.prototype._endInner=function(t,e,n){this.current.remove(n),l(t,n,this),0===this.pending.length?this._checkEnd(t,e):this._startInner(t,this.pending.shift())},xt.prototype._checkEnd=function(t,e){!this.active&&this.current.isEmpty()&&this.sink.end(t,e)},Tt.prototype.event=function(t,e){this.sink.event(Math.max(t,this.time),e)},Tt.prototype.end=function(t,e){this.outer._endInner(Math.max(t,this.time),e,this)},Tt.prototype.error=function(t,e){this.outer.error(Math.max(t,this.time),e)},Tt.prototype.dispose=function(){return this.disposable.dispose()};var qn=function(t,e){return gt(t,1/0,e)},Nn=function(t){return _t(1/0,t)},Sn=r,Bn=s;Rt.prototype.run=function(t,e){for(var n,i=this,r=this.sources.length,o=new Array(r),s=new Array(r),u=new qt(o,s,t),h=0;h<r;++h)n=s[h]=new pt(h,u),o[h]=i.sources[h].run(n,e);return rn(o)},qt.prototype.error=I.prototype.error,qt.prototype.event=function(t,e){this.sink.event(t,e.value)},qt.prototype.end=function(t,e){l(t,this.disposables[e.index],this.sink),0===--this.activeCount&&this.sink.end(t,e.value)};var jn=function(t,e,n){return new a(new Vn(t,e,n))},Vn=function(t,e,n){this.source=n.source,this.sampler=e.source,this.f=t};Vn.prototype.run=function(t,e){var n=new Wn(this.f,this.source,t),i=this.source.run(n.hold,e),r=this.sampler.run(n,e);return rn([r,i])};var Wn=function(t){function e(e,n,i){t.call(this,i),this.sink=i,this.source=n,this.f=e,this.hold=new Dn(this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.event=function(t,e){if(this.hold.hasValue){var n=this.f;this.sink.event(t,n(e,this.hold.value))}},e}(I),Dn=function(t){function e(e){t.call(this,e),this.hasValue=!1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.event=function(t,e){this.value=e,this.hasValue=!0},e.prototype.end=function(){},e}(I);Nt.prototype.push=function(t){var e=this._length;this._checkCapacity(e+1);var n=this._head+e&this._capacity-1;this[n]=t,this._length=e+1},Nt.prototype.shift=function(){var t=this._head,e=this[t];return this[t]=void 0,this._head=t+1&this._capacity-1,this._length--,e},Nt.prototype.isEmpty=function(){return 0===this._length},Nt.prototype.length=function(){return this._length},Nt.prototype._checkCapacity=function(t){this._capacity<t&&this._ensureCapacity(this._capacity<<1)},Nt.prototype._ensureCapacity=function(t){var e=this._capacity;this._capacity=t;var n=this._head+this._length;n>e&&St(this,0,this,e,n&e-1)};var On=o,zn=i;Wt.prototype.run=function(t,e){for(var n,i=this,r=this.sources.length,o=new Array(r),s=new Array(r),u=new Array(r),h=new Dt(this.f,u,s,t),c=0;c<r;++c)u[c]=new Nt,n=s[c]=new pt(c,h),o[c]=i.sources[c].run(n,e);return rn(o)},Dt.prototype.event=function(t,e){var n=this.buffers,i=n[e.index];if(i.push(e.value),1===i.length()){if(!Ft(this.buffers))return;Ot(this.f,t,n,this.sink),Lt(this.buffers,this.sinks)&&this.sink.end(t,void 0)}},Dt.prototype.end=function(t,e){var n=this.buffers[e.index];n.isEmpty()&&this.sink.end(t,e.value)},Dt.prototype.error=I.prototype.error;var Ln=function(t){return new a(new Fn(t.source))},Fn=function(t){this.source=t};Fn.prototype.run=function(t,e){var n=new Gn(t,e);return rn([n,this.source.run(n,e)])};var Gn=function(t,e){this.sink=t,this.scheduler=e,this.current=null,this.ended=!1};Gn.prototype.event=function(t,e){this._disposeCurrent(t),this.current=new Hn(t,1/0,this,this.sink),this.current.disposable=e.source.run(this.current,this.scheduler)},Gn.prototype.end=function(t,e){this.ended=!0,this._checkEnd(t,e)},Gn.prototype.error=function(t,e){this.ended=!0,this.sink.error(t,e)},Gn.prototype.dispose=function(){return this._disposeCurrent(this.scheduler.now())},Gn.prototype._disposeCurrent=function(t){if(null!==this.current)return this.current._dispose(t)},Gn.prototype._disposeInner=function(t,e){e._dispose(t),e===this.current&&(this.current=null)},Gn.prototype._checkEnd=function(t,e){this.ended&&null===this.current&&this.sink.end(t,e)},Gn.prototype._endInner=function(t,e,n){this._disposeInner(t,n),this._checkEnd(t,e)},Gn.prototype._errorInner=function(t,e,n){this._disposeInner(t,n),this.sink.error(t,e)};var Hn=function(t,e,n,i){this.min=t,this.max=e,this.outer=n,this.sink=i,this.disposable=nn()};Hn.prototype.event=function(t,e){t<this.max&&this.sink.event(Math.max(t,this.min),e)},Hn.prototype.end=function(t,e){this.outer._endInner(Math.max(t,this.min),e,this)},Hn.prototype.error=function(t,e){this.outer._errorInner(Math.max(t,this.min),e,this)},Hn.prototype._dispose=function(t){this.max=t,l(t,this.disposable,this.sink)},Kt.prototype.run=function(t,e){return this.source.run(new Qt(this.equals,t),e)},Qt.prototype.end=I.prototype.end,Qt.prototype.error=I.prototype.error,Qt.prototype.event=function(t,e){this.init?(this.init=!1,this.value=e,this.sink.event(t,e)):this.equals(this.value,e)||(this.value=e,this.sink.event(t,e))},ne.prototype.run=function(t,e){return new ie(this.min,this.max-this.min,this.source,t,e)},ie.prototype.end=I.prototype.end,ie.prototype.error=I.prototype.error,ie.prototype.event=function(t,e){return this.skip>0?void(this.skip-=1):void(0!==this.take&&(this.take-=1,this.sink.event(t,e),0===this.take&&(this.dispose(),this.sink.end(t,e))))},ie.prototype.dispose=function(){return this.disposable.dispose()},oe.prototype.run=function(t,e){return new se(this.p,this.source,t,e)},se.prototype.end=I.prototype.end,se.prototype.error=I.prototype.error,se.prototype.event=function(t,e){if(this.active){var n=this.p;this.active=n(e),this.active?this.sink.event(t,e):(this.dispose(),this.sink.end(t,e))}},se.prototype.dispose=function(){return this.disposable.dispose()},he.prototype.run=function(t,e){return this.source.run(new ce(this.p,t),e)},ce.prototype.end=I.prototype.end,ce.prototype.error=I.prototype.error,ce.prototype.event=function(t,e){if(this.skipping){var n=this.p;if(this.skipping=n(e),this.skipping)return}this.sink.event(t,e)},de.prototype.run=function(t,e){var n=new ve(-(1/0),t),i=new ke(this.maxSignal,t,e),r=this.source.run(new ye(n,i,t),e);return rn([n,i,r])},le.prototype.run=function(t,e){var n=new we(this.minSignal,t,e),i=new ve(1/0,t),r=this.source.run(new ye(n,i,t),e);return rn([n,i,r])},ve.prototype.error=I.prototype.error,ve.prototype.event=me,ve.prototype.end=me,ve.prototype.dispose=me,ye.prototype.event=function(t,e){t>=this.min.value&&t<this.max.value&&this.sink.event(t,e)},ye.prototype.error=I.prototype.error,ye.prototype.end=I.prototype.end,we.prototype.event=function(t){t<this.value&&(this.value=t)},we.prototype.end=me,we.prototype.error=I.prototype.error,we.prototype.dispose=function(){return this.disposable.dispose()},ke.prototype.event=function(t,e){t<this.value&&(this.value=t,this.sink.end(t,e))},ke.prototype.end=me,ke.prototype.error=I.prototype.error,ke.prototype.dispose=function(){return this.disposable.dispose()},ge.prototype.run=function(t,e){var n=new be(this.dt,t,e);return rn([n,this.source.run(n,e)])},be.prototype.dispose=function(){var t=this;this.scheduler.cancelAll(function(e){return e.sink===t.sink})},be.prototype.event=function(t,e){this.scheduler.delay(this.dt,y.event(e,this.sink))},be.prototype.end=function(t,e){this.scheduler.delay(this.dt,y.end(e,this.sink))},be.prototype.error=I.prototype.error,Pe.prototype.run=function(t,e){return this.source.run(new Ie(this.period,t),e)},Ie.prototype.event=function(t,e){t>=this.time&&(this.time=t+this.period,this.sink.event(t,e))},Ie.prototype.end=I.prototype.end,Ie.prototype.error=I.prototype.error,Me.prototype.run=function(t,e){return new Re(this.dt,this.source,t,e)},Re.prototype.event=function(t,e){this._clearTimer(),this.value=e,this.timer=this.scheduler.delay(this.dt,y.event(e,this.sink))},Re.prototype.end=function(t,e){this._clearTimer()&&(this.sink.event(t,this.value),this.value=void 0),this.sink.end(t,e)},Re.prototype.error=function(t,e){this._clearTimer(),this.sink.error(t,e)},Re.prototype.dispose=function(){this._clearTimer()},Re.prototype._clearTimer=function(){return null!==this.timer&&(this.timer.dispose(),this.timer=null,!0)};var Jn=function(t){return new a(new Qn(t.source))},Kn=Xe(Jn,hn),Qn=function(t){this.source=t};Qn.prototype.run=function(t,e){return this.source.run(new Un(t,e),e)};var Un=function(t,e){var n=this;this.sink=t,this.scheduler=e,this.queue=Promise.resolve(),this._eventBound=function(t){return n.sink.event(n.scheduler.now(),t)},this._endBound=function(t){return n.sink.end(n.scheduler.now(),t)},this._errorBound=function(t){return n.sink.error(n.scheduler.now(),t)}};Un.prototype.event=function(t,e){var n=this;this.queue=this.queue.then(function(){return n._event(e)}).catch(this._errorBound)},Un.prototype.end=function(t,e){var n=this;this.queue=this.queue.then(function(){return n._end(e)}).catch(this._errorBound)},Un.prototype.error=function(t,e){var n=this;this.queue=this.queue.then(function(){return n._errorBound(e)}).catch(v)},Un.prototype._event=function(t){return t.then(this._eventBound)},Un.prototype._end=function(t){return Promise.resolve(t).then(this._endBound)},qe.prototype.event=function(t,e){this.active&&this.sink.event(t,e)},qe.prototype.end=function(t,e){this.active&&(this.disable(),this.sink.end(t,e))},qe.prototype.error=function(t,e){this.disable(),this.sink.error(t,e)},qe.prototype.disable=function(){return this.active=!1,this.sink},Ve.prototype.run=function(t,e){return e.asap(new y(We,this.value,t))},De.prototype.run=function(t,e){return new Oe(this.f,this.source,t,e)},Oe.prototype.event=function(t,e){Ne(t,e,this.sink)},Oe.prototype.end=function(t,e){Se(t,e,this.sink)},Oe.prototype.error=function(t,e){var n=this.sink.disable();l(t,this.disposable,this.sink),this._startNext(t,e,n)},Oe.prototype._startNext=function(t,e,n){try{this.disposable=this._continue(this.f,e,n)}catch(e){n.error(t,e)}},Oe.prototype._continue=function(t,e,n){var i=t(e);return i.source.run(n,this.scheduler)},Oe.prototype.dispose=function(){return this.disposable.dispose()},ze.prototype.run=function(){return this.task.run(this.time)},ze.prototype.error=function(t){return this.task.error(this.time,t)},ze.prototype.dispose=function(){return this.scheduler.cancel(this),this.task.dispose()};var Xn=function(t,e){var n=this;this.timer=t,this.timeline=e,this._timer=null,this._nextArrival=1/0,this._runReadyTasksBound=function(){return n._runReadyTasks(n.now())}};Xn.prototype.now=function(){return this.timer.now()},Xn.prototype.asap=function(t){return this.schedule(0,-1,t)},Xn.prototype.delay=function(t,e){return this.schedule(t,-1,e)},Xn.prototype.periodic=function(t,e){return this.schedule(0,t,e)},Xn.prototype.schedule=function(t,e,n){var i=this.now(),r=new ze(i+Math.max(0,t),e,n,this);return this.timeline.add(r),this._scheduleNextRun(i),r},Xn.prototype.cancel=function(t){t.active=!1,this.timeline.remove(t)&&this._reschedule()},Xn.prototype.cancelAll=function(t){this.timeline.removeAll(t),this._reschedule()},Xn.prototype._reschedule=function(){this.timeline.isEmpty()?this._unschedule():this._scheduleNextRun(this.now())},Xn.prototype._unschedule=function(){this.timer.clearTimer(this._timer),this._timer=null},Xn.prototype._scheduleNextRun=function(t){if(!this.timeline.isEmpty()){var e=this.timeline.nextArrival();null===this._timer?this._scheduleNextArrival(e,t):e<this._nextArrival&&(this._unschedule(),this._scheduleNextArrival(e,t))}},Xn.prototype._scheduleNextArrival=function(t,e){this._nextArrival=t;var n=Math.max(0,t-e);this._timer=this.timer.setTimer(this._runReadyTasksBound,n)},Xn.prototype._runReadyTasks=function(t){this._timer=null,this.timeline.runTasks(t,Fe),this._scheduleNextRun(this.now())};var Yn=function(){this.tasks=[]};Yn.prototype.nextArrival=function(){return this.isEmpty()?1/0:this.tasks[0].time},Yn.prototype.isEmpty=function(){return 0===this.tasks.length},Yn.prototype.add=function(t){He(t,this.tasks)},Yn.prototype.remove=function(t){var e=Ke(t.time,this.tasks);if(e>=0&&e<this.tasks.length){var n=h(t,this.tasks[e].events);if(n>=0)return this.tasks[e].events.splice(n,1),!0}return!1},Yn.prototype.removeAll=function(t){for(var e=this,n=0;n<this.tasks.length;++n)Je(t,e.tasks[n])},Yn.prototype.runTasks=function(t,e){for(var n=this,i=this.tasks,r=i.length,o=0;o<r&&i[o].time<=t;)++o;this.tasks=i.slice(o);for(var s=0;s<o;++s)n.tasks=Ge(e,i[s].events,n.tasks)};var Zn=function(t,e){return{time:t,events:e}},$n=function(){this.now=Date.now};$n.prototype.setTimer=function(t,e){return e<=0?Qe(t):setTimeout(t,e)},$n.prototype.clearTimer=function(t){return t instanceof ti?t.cancel():clearTimeout(t)};var ti=function(t){this.f=t,this.active=!0};ti.prototype.run=function(){return this.active&&this.f()},ti.prototype.error=function(t){throw t},ti.prototype.cancel=function(){this.active=!1};var ei=c(gn),ni=p(C),ii=p(Tn),ri=c(q),oi=c(V),si=c(Cn),ui=c(In),hi=c(ot),ci=c(st),pi=c(ut),ai=c(kt),fi=c(qn),di=c(U),li=c(Et),vi=c(_t),yi=p(gt),wi=c(dt),ki=p(jn),mi=c(jt),_i=c(Gt),gi=c(Jt),bi=c(Xt),xi=c(Yt),Ai=p(Zt),Ti=c(re),Ei=c(ue),Pi=c(pe),Ii=c(ae),Ci=c(fe),Mi=c(_e),Ri=c(xe),qi=c(Ce),Ni=c(Be),Si=function(){return new Xn(new $n,new Yn)};t.runEffects=ei,t.loop=ni,t.scan=ii,t.unfold=ri,t.iterate=oi,t.concat=si,t.startWith=ui,t.map=hi,t.constant=ci,t.tap=pi,t.ap=ai,t.chain=fi,t.join=Nn,t.continueWith=di,
t.concatMap=li,t.mergeConcurrently=vi,t.mergeMapConcurrently=yi,t.combine=ft,t.combineArray=wi,t.sample=ki,t.zip=Bt,t.zipArray=mi,t.filter=_i,t.skipRepeats=Ht,t.skipRepeatsWith=gi,t.take=bi,t.skip=xi,t.slice=Ai,t.takeWhile=Ti,t.skipWhile=Ei,t.until=Pi,t.since=Ii,t.during=Ci,t.delay=Mi,t.throttle=Ri,t.debounce=qi,t.recoverWith=Ni,t.throwError=je,t.createDefaultScheduler=Si,t.Scheduler=Xn,t.Timeline=Yn,t.ClockTimer=$n,t.Stream=a,t.just=hn,t.empty=pn,t.never=ln,t.periodic=g,t.fromArray=b,t.fromIterable=mn,t.generate=L,t.merge=Pt,t.mergeArray=It,t.switchLatest=Ln,t.fromPromise=Kn,t.awaitPromises=Jn,t.PropagateTask=y,Object.defineProperty(t,"__esModule",{value:!0})});